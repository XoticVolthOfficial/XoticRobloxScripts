-- Grok Hub: Visual + Combat (Nov 2025)
-- Visual = Discreet ESP • Combat = Recoil Control + No Spread (Framework games) + Head Expander

loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

local Fluent = getgenv().Fluent

Fluent:Notify({
    Title = "Grok Hub",
    Content = "Visual + Combat loaded!",
    Duration = 7
})

local Window = Fluent:CreateWindow({
    Title = "Grok Hub",
    SubTitle = "by xAI",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 520),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftAlt
})

local VisualTab = Window:AddTab({ Title = "Visual", Icon = "eye" })
local CombatTab = Window:AddTab({ Title = "Combat", Icon = "crosshair" })

-- ========================= VISUAL ESP (FULL CODE FROM YOUR LAST SCRIPT) =========================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local player = Players.LocalPlayer

local VISUAL_ENABLED = false
local VISUAL_OBJECTS = {}
local updateConnection = nil

local SHOW_BOXES = true
local SHOW_TRACERS = true
local SHOW_LABELS = true
local SHOW_DISTANCE = true
local SHOW_HEALTH = true
local TEAM_CHECK = false
local RAINBOW_ENABLED = false
local THICKNESS = 2
local VISUAL_TRANSPARENCY = 1
local MAX_DISTANCE = 10000

local BOX_COLOR = Color3.fromRGB(0, 255, 0)
local TRACER_COLOR = BOX_COLOR
local NAME_COLOR = Color3.fromRGB(255, 255, 255)

local function updateVisualProps()
    for _, objects in pairs(VISUAL_OBJECTS) do
        if objects.box then
            objects.box.Thickness = THICKNESS
            objects.box.Transparency = VISUAL_TRANSPARENCY
        end
        if objects.tracer then
            objects.tracer.Thickness = THICKNESS
            objects.tracer.Transparency = VISUAL_TRANSPARENCY
        end
    end
end

local function createVisual(plr)
    if plr == player or VISUAL_OBJECTS[plr] then return end

    local objects = {}

    local box = Drawing.new("Square")
    box.Filled = false
    box.Thickness = THICKNESS
    box.Color = BOX_COLOR
    box.Transparency = VISUAL_TRANSPARENCY
    box.Visible = false
    objects.box = box

    local label = Drawing.new("Text")
    label.Size = 15
    label.Center = true
    label.Outline = true
    label.Font = 2
    label.Color = NAME_COLOR
    label.Transparency = 1
    label.Visible = false
    objects.label = label

    local tracer = Drawing.new("Line")
    tracer.Color = TRACER_COLOR
    tracer.Transparency = VISUAL_TRANSPARENCY
    tracer.Thickness = THICKNESS
    tracer.Visible = false
    objects.tracer = tracer

    VISUAL_OBJECTS[plr] = objects
end

local function removeVisual(plr)
    local objects = VISUAL_OBJECTS[plr]
    if objects then
        for _, obj in pairs(objects) do obj:Remove() end
        VISUAL_OBJECTS[plr] = nil
    end
end

local function toggleVisual(state)
    VISUAL_ENABLED = state
    if state then
        for _, plr in ipairs(Players:GetPlayers()) do
            if plr ~= player then createVisual(plr) end
        end

        updateConnection = RunService.RenderStepped:Connect(function()
            local myRoot = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
            if not myRoot then return end
            local myPos = myRoot.Position

            for plr, objects in pairs(VISUAL_OBJECTS) do
                if TEAM_CHECK and plr.Team and player.Team and plr.Team == player.Team then
                    objects.box.Visible = false
                    objects.label.Visible = false
                    objects.tracer.Visible = false
                    continue
                end

                local char = plr.Character
                local root = char and char:FindFirstChild("HumanoidRootPart")
                local hum = char and char:FindFirstChildOfClass("Humanoid")
                local head = char and char:FindFirstChild("Head")

                if not (root and hum and head and hum.Health > 0) then
                    removeVisual(plr)
                    continue
                end

                local dist = (root.Position - myPos).Magnitude
                if MAX_DISTANCE > 0 and dist > MAX_DISTANCE then
                    objects.box.Visible = false
                    objects.label.Visible = false
                    objects.tracer.Visible = false
                    continue
                end

                local headPos3D = head.Position + Vector3.new(0, 0.5, 0)
                local legPos3D = root.Position - Vector3.new(0, 4, 0)

                local headScreen, headVisible = Camera:WorldToViewportPoint(headPos3D)
                local legScreen, legVisible = Camera:WorldToViewportPoint(legPos3D)
                local rootScreen = Camera:WorldToViewportPoint(root.Position)

                if headVisible or legVisible then
                    local head2D = Vector2.new(headScreen.X, headScreen.Y)
                    local leg2D = Vector2.new(legScreen.X, legScreen.Y)
                    local root2D = Vector2.new(rootScreen.X, rootScreen.Y)

                    local height = math.abs(leg2D.Y - head2D.Y)
                    local width = height * 0.5

                    if SHOW_BOXES then
                        objects.box.Position = Vector2.new(head2D.X - width / 2, head2D.Y)
                        objects.box.Size = Vector2.new(width, height)
                        local rc = RAINBOW_ENABLED and Color3.fromHSV(tick() % 5 / 5, 1, 1) or BOX_COLOR
                        objects.box.Color = rc
                        objects.box.Visible = true
                    else
                        objects.box.Visible = false
                    end

                    if SHOW_LABELS then
                        local distFloor = math.floor(dist)
                        local healthPerc = math.floor((hum.Health / hum.MaxHealth) * 100)
                        local text = plr.DisplayName .. "\n" .. plr.Name
                        if SHOW_DISTANCE then text = text .. " | " .. distFloor .. "m" end
                        if SHOW_HEALTH then text = text .. " | " .. healthPerc .. "%" end

                        objects.label.Text = text
                        objects.label.Position = Vector2.new(head2D.X, head2D.Y - 24)
                        objects.label.Visible = true
                    else
                        objects.label.Visible = false
                    end

                    if SHOW_TRACERS then
                        local from = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
                        objects.tracer.From = from
                        objects.tracer.To = root2D
                        local rc = RAINBOW_ENABLED and Color3.fromHSV(tick() % 5 / 5, 1, 1) or TRACER_COLOR
                        objects.tracer.Color = rc
                        objects.tracer.Visible = true
                    else
                        objects.tracer.Visible = false
                    end
                else
                    objects.box.Visible = false
                    objects.label.Visible = false
                    objects.tracer.Visible = false
                end
            end
        end)

        Fluent:Notify({Title = "Visual", Content = "Enabled", Duration = 3})
    else
        for plr in pairs(VISUAL_OBJECTS) do removeVisual(plr) end
        if updateConnection then updateConnection:Disconnect() updateConnection = nil end
        Fluent:Notify({Title = "Visual", Content = "Disabled", Duration = 3})
    end
end

Players.PlayerAdded:Connect(function(plr)
    if plr == player then return end
    plr.CharacterAdded:Connect(function()
        if VISUAL_ENABLED then task.wait(0.5) createVisual(plr) end
    end)
end)
Players.PlayerRemoving:Connect(removeVisual)

for _, plr in ipairs(Players:GetPlayers()) do
    if plr ~= player then
        plr.CharacterAdded:Connect(function()
            if VISUAL_ENABLED then task.wait(0.5) createVisual(plr) end
        end)
    end
end

-- Visual UI
VisualTab:AddParagraph({Title = "Player Visuals", Content = "Clean ESP • Boxes • Tracers • Names/Distance/Health • Max 10,000 studs default"})

VisualTab:AddToggle("visual_main", {Title = "Enable Visual", Default = false, Callback = toggleVisual})

VisualTab:AddToggle("visual_boxes", {Title = "Boxes", Default = true, Callback = function(v) SHOW_BOXES = v end})
VisualTab:AddToggle("visual_tracers", {Title = "Tracers", Default = true, Callback = function(v) SHOW_TRACERS = v end})
VisualTab:AddToggle("visual_labels", {Title = "Name Labels", Default = true, Callback = function(v) SHOW_LABELS = v end})
VisualTab:AddToggle("visual_distance", {Title = "Show Distance", Default = true, Callback = function(v) SHOW_DISTANCE = v end})
VisualTab:AddToggle("visual_health", {Title = "Show Health %", Default = true, Callback = function(v) SHOW_HEALTH = v end})
VisualTab:AddToggle("visual_teamcheck", {Title = "Team Check", Default = false, Callback = function(v) TEAM_CHECK = v end})
VisualTab:AddToggle("visual_rainbow", {Title = "Rainbow Mode", Default = false, Callback = function(v) RAINBOW_ENABLED = v end})

VisualTab:AddSlider("visual_maxdist", {
    Title = "Max Distance (0 = Unlimited)",
    Min = 0,
    Max = 50000,
    Default = 10000,
    Rounding = 100,
    Callback = function(v) MAX_DISTANCE = v end
})

VisualTab:AddSlider("visual_thickness", {Title = "Thickness", Min = 1, Max = 10, Default = 2, Rounding = 0, Callback = function(v) THICKNESS = v updateVisualProps() end})
VisualTab:AddSlider("visual_transparency", {Title = "Transparency %", Min = 0, Max = 100, Default = 100, Rounding = 0, Callback = function(v) VISUAL_TRANSPARENCY = v/100 updateVisualProps() end})

-- ========================= COMBAT TAB (YOUR REQUESTED GUN MODS) =========================

local recoilScale = 0 -- 0 = no recoil, 1 = full recoil
local noSpreadEnabled = false

CombatTab:AddParagraph({Title = "Gun Mods", Content = "Recoil Control & No Spread\nWorks in Framework games (Energy Assault, etc.) + universal recoil reduction"})

CombatTab:AddSlider("recoil_control", {
    Title = "Recoil Control",
    Min = 0,
    Max = 100,
    Default = 100,
    Rounding = 1,
    Callback = function(value)
        recoilScale = 1 - (value / 100) -- 100% control = 0 recoil
        Fluent:Notify({Title = "Recoil", Content = value.."% control", Duration = 2})
    end
})

CombatTab:AddToggle("no_spread", {
    Title = "No Spread",
    Default = false,
    Callback = function(state)
        noSpreadEnabled = state
        Fluent:Notify({Title = "No Spread", Content = state and "Enabled" or "Disabled", Duration = 2})
    end
})

-- Universal No Recoil (works in Phantom Forces, Arsenal, Counter Blox, etc.)
local mt = getrawmetatable(game)
local old = mt.__namecall
setreadonly(mt, false)

mt.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod()
    if self == workspace.CurrentCamera and method == "Kick" then
        local args = {...}
        args[1] = args[1] * recoilScale
        return old(self, unpack(args))
    end
    return old(self, ...)
end)
setreadonly(mt, true)

-- Framework No Spread (Energy Assault & similar games)
task.spawn(function()
    local success, err = pcall(function()
        local ReplicatedFirst = game:GetService("ReplicatedFirst")
        local FrameworkModule = require(ReplicatedFirst:WaitForChild("Framework", 15))
        if not FrameworkModule then return end

        FrameworkModule:WaitForLoaded()

        local Bullets = FrameworkModule.Libraries.Bullets
        local GetSpreadAngle = getupvalue(Bullets.Fire, 1)

        hookfunction(GetSpreadAngle, newcclosure(function(...)
            if noSpreadEnabled then
                return 0
            end
            return GetSpreadAngle(...)
        end))
    end)

    if not success then
        -- Silently fail - game doesn't use Framework
    end
end)

-- ========================= HEAD EXPANDER (INTEGRATED FOR APOCALYPSE RISING 2) =========================

local headExpanderEnabled = false
local headSizeValue = 5
local headTransparencyValue = 0
local headConnections = {}
local headPlayerAddedConn = nil

local function ApplyHeadChanges(plr)
    if plr == Players.LocalPlayer then return end
    local char = plr.Character
    if char then
        local head = char:FindFirstChild("Head")
        if head and head:IsA("MeshPart") then
            head.Size = Vector3.new(2 * headSizeValue, 1 * headSizeValue, 1 * headSizeValue)
            head.Transparency = headTransparencyValue
        end
    end
end

CombatTab:AddParagraph({Title = "Head Expander", Content = "Expands other players' heads for easier headshots (Client-side, works in Apocalypse Rising 2)"})

CombatTab:AddToggle("head_expander", {
    Title = "Enable Head Expander",
    Default = false,
    Callback = function(enabled)
        headExpanderEnabled = enabled
        if enabled then
            for _, plr in ipairs(Players:GetPlayers()) do
                if plr ~= Players.LocalPlayer then
                    ApplyHeadChanges(plr)
                    headConnections[plr] = plr.CharacterAdded:Connect(function()
                        task.wait(0.5)
                        ApplyHeadChanges(plr)
                    end)
                end
            end
            headPlayerAddedConn = Players.PlayerAdded:Connect(function(plr)
                if plr ~= Players.LocalPlayer then
                    ApplyHeadChanges(plr)
                    headConnections[plr] = plr.CharacterAdded:Connect(function()
                        task.wait(0.5)
                        ApplyHeadChanges(plr)
                    end)
                end
            end)
            Fluent:Notify({Title = "Head Expander", Content = "Enabled", Duration = 3})
        else
            for _, plr in ipairs(Players:GetPlayers()) do
                if plr ~= Players.LocalPlayer then
                    local char = plr.Character
                    if char then
                        local head = char:FindFirstChild("Head")
                        if head and head:IsA("MeshPart") then
                            head.Size = Vector3.new(2, 1, 1)
                            head.Transparency = 0
                        end
                    end
                end
            end
            for _, conn in pairs(headConnections) do
                conn:Disconnect()
            end
            headConnections = {}
            if headPlayerAddedConn then
                headPlayerAddedConn:Disconnect()
                headPlayerAddedConn = nil
            end
            Fluent:Notify({Title = "Head Expander", Content = "Disabled", Duration = 3})
        end
    end
})

CombatTab:AddSlider("head_size", {
    Title = "Head Size Scale",
    Min = 1,
    Max = 50,
    Default = 5,
    Rounding = 1,
    Callback = function(value)
        headSizeValue = value
        if headExpanderEnabled then
            for _, plr in ipairs(Players:GetPlayers()) do
                if plr ~= Players.LocalPlayer then
                    ApplyHeadChanges(plr)
                end
            end
        end
    end
})

CombatTab:AddSlider("head_transparency", {
    Title = "Head Transparency",
    Min = 0,
    Max = 1,
    Default = 0,
    Rounding = 2,
    Callback = function(value)
        headTransparencyValue = value
        if headExpanderEnabled then
            for _, plr in ipairs(Players:GetPlayers()) do
                if plr ~= Players.LocalPlayer then
                    ApplyHeadChanges(plr)
                end
            end
        end
    end
})

print("Grok Hub loaded — LeftAlt to open | Visual + Combat ready")
