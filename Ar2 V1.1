-- Load Fluent
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

-- === Services & vars ===
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- === Aimbot / Drawing defaults ===
local Holding = false
_G.AimbotEnabled = false
_G.TeamCheck = false
_G.AimPart = "Head"
_G.Sensitivity = 0

_G.CircleSides = 64
_G.CircleColor = Color3.fromRGB(255, 255, 255)
_G.CircleTransparency = 0.7
_G.CircleRadius = 80
_G.CircleFilled = false
_G.CircleVisible = true
_G.CircleThickness = 0

local FOVCircle
pcall(function() FOVCircle = Drawing.new("Circle") end)
if FOVCircle then
    FOVCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    FOVCircle.Radius = _G.CircleRadius
    FOVCircle.Filled = _G.CircleFilled
    FOVCircle.Color = _G.CircleColor
    FOVCircle.Visible = _G.CircleVisible
    FOVCircle.Transparency = _G.CircleTransparency
    FOVCircle.NumSides = _G.CircleSides
    FOVCircle.Thickness = _G.CircleThickness
end

-- === Visual / ESP / NameTags state ===
local ESPEnabled = false -- <-- starts OFF (will not auto-enable)
local ESPColor = Color3.fromRGB(255, 0, 0)
local SkeletonEnabled = false
local NameDistanceEnabled = false
local NameTags = {}      -- map player -> TextLabel (BillboardGui child)
local Highlights = {}    -- map player -> Highlight instance (so we can remove)

-- Helper: add highlight (ESP) to single player
local function AddESP(plr)
    if not plr or plr == LocalPlayer then return end
    if plr.Character and plr.Character.PrimaryPart then
        -- remove existing highlight if stale
        if Highlights[plr] and Highlights[plr].Parent then
            Highlights[plr].Adornee = plr.Character
            Highlights[plr].Enabled = ESPEnabled
            Highlights[plr].FillColor = ESPColor
            return
        end

        local highlight = Instance.new("Highlight")
        highlight.Name = "ESPHighlight"
        highlight.Adornee = plr.Character
        highlight.FillColor = ESPColor
        highlight.OutlineColor = Color3.fromRGB(0,0,0)
        highlight.Enabled = ESPEnabled
        highlight.Parent = plr.Character
        Highlights[plr] = highlight
    end
end

-- Helper: remove highlight for a player
local function RemoveESP(plr)
    local h = Highlights[plr]
    if h and h.Parent then
        h:Destroy()
    end
    Highlights[plr] = nil
end

-- Create/Destroy name+distance billboard for player
local function CreateNameTag(plr)
    if not plr or plr == LocalPlayer then return end
    if not (plr.Character and plr.Character:FindFirstChild("Head")) then return end

    -- if exists, remove and recreate to keep things clean
    if NameTags[plr] then
        local oldGui = NameTags[plr].Parent
        if oldGui and oldGui.Parent then oldGui:Destroy() end
        NameTags[plr] = nil
    end

    local head = plr.Character:FindFirstChild("Head")
    if not head then return end

    local billboard = Instance.new("BillboardGui")
    billboard.Name = "NameDistance"
    billboard.Adornee = head
    billboard.Size = UDim2.new(0, 180, 0, 40)
    billboard.StudsOffset = Vector3.new(0, 2.2, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = plr.Character

    local textLabel = Instance.new("TextLabel")
    textLabel.BackgroundTransparency = 1
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.TextScaled = true
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.Font = Enum.Font.SourceSansBold
    textLabel.TextStrokeTransparency = 0.6
    textLabel.Parent = billboard

    NameTags[plr] = textLabel
end

local function RemoveNameTag(plr)
    local label = NameTags[plr]
    if label then
        local gui = label.Parent
        if gui and gui.Parent then gui:Destroy() end
    end
    NameTags[plr] = nil
end

-- Keep NameTags updated every frame when enabled
RunService.RenderStepped:Connect(function()
    -- update FOV circle if available
    if FOVCircle then
        local mpos = Vector2.new(UserInputService:GetMouseLocation().X, UserInputService:GetMouseLocation().Y)
        FOVCircle.Position = mpos
        FOVCircle.Radius = _G.CircleRadius
        FOVCircle.Filled = _G.CircleFilled
        FOVCircle.Color = _G.CircleColor
        FOVCircle.Visible = _G.CircleVisible
        FOVCircle.Transparency = _G.CircleTransparency
        FOVCircle.NumSides = _G.CircleSides
        FOVCircle.Thickness = _G.CircleThickness
    end

    -- update name tags text
    if NameDistanceEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        for plr, label in pairs(NameTags) do
            if plr and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                local dist = (LocalPlayer.Character.HumanoidRootPart.Position - plr.Character.HumanoidRootPart.Position).Magnitude
                -- two lines: name on first line, distance on second line
                label.Text = plr.Name .. "\n" .. math.floor(dist) .. " studs"
            else
                label.Text = ""
            end
        end
    end
end)

-- Automatically apply/remove to players when they join/leave/respawn
Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Connect(function()
        if ESPEnabled then AddESP(plr) end
        if NameDistanceEnabled then CreateNameTag(plr) end
    end)
end)

Players.PlayerRemoving:Connect(function(plr)
    RemoveESP(plr)
    RemoveNameTag(plr)
end)

Players.LocalPlayer.CharacterAdded:Connect(function()
    -- reapply ESP for others when you respawn
    if ESPEnabled then
        for _, p in ipairs(Players:GetPlayers()) do
            if p ~= LocalPlayer then AddESP(p) end
        end
    end
    -- reapply name tags
    if NameDistanceEnabled then
        for _, p in ipairs(Players:GetPlayers()) do
            if p ~= LocalPlayer then CreateNameTag(p) end
        end
    end
end)

-- === Aimbot core (unchanged logic, safe checks) ===
local function GetClosestPlayer()
    local MaximumDistance = _G.CircleRadius
    local Target = nil
    local nearest = MaximumDistance

    for _, v in ipairs(Players:GetPlayers()) do
        if v ~= LocalPlayer and v.Character and v.Character.Parent then
            local humanoid = v.Character:FindFirstChildOfClass("Humanoid")
            local hrp = v.Character:FindFirstChild("HumanoidRootPart")
            if humanoid and hrp and humanoid.Health > 0 then
                if _G.TeamCheck and v.Team == LocalPlayer.Team then
                    -- skip teammates
                else
                    local aimPart = v.Character:FindFirstChild(_G.AimPart) or hrp
                    if aimPart then
                        local screenPoint, onScreen = Camera:WorldToScreenPoint(aimPart.Position)
                        if onScreen then
                            local mousePos = Vector2.new(UserInputService:GetMouseLocation().X, UserInputService:GetMouseLocation().Y)
                            local vecDist = (mousePos - Vector2.new(screenPoint.X, screenPoint.Y)).Magnitude
                            if vecDist < nearest then
                                nearest = vecDist
                                Target = v
                            end
                        end
                    end
                end
            end
        end
    end
    return Target
end

UserInputService.InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        Holding = true
    end
end)
UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        Holding = false
    end
end)

RunService.RenderStepped:Connect(function()
    if Holding and _G.AimbotEnabled then
        local target = GetClosestPlayer()
        if target and target.Character then
            local aimPart = target.Character:FindFirstChild(_G.AimPart) or target.Character:FindFirstChild("HumanoidRootPart")
            if aimPart and Camera and Camera.CFrame then
                if tonumber(_G.Sensitivity) and _G.Sensitivity > 0 then
                    pcall(function()
                        local tween = TweenService:Create(Camera, TweenInfo.new(_G.Sensitivity, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {CFrame = CFrame.new(Camera.CFrame.Position, aimPart.Position)})
                        tween:Play()
                    end)
                else
                    Camera.CFrame = CFrame.new(Camera.CFrame.Position, aimPart.Position)
                end
            end
        end
    end
end)

-- === UI (Fluent) ===
local Window = Fluent:CreateWindow({
    Title = "XoticVolthAR2",
    SubTitle = "Power Hub",
    TabWidth = 120,
    Size = UDim2.fromOffset(520, 360),
})

-- Toggle UI with F1
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.F1 then Window:Toggle() end
end)

-- --- Main Tab ---
local MainTab = Window:AddTab({ Title = "Main", Icon = "home" })
MainTab:AddButton({
    Title = "Click Me!",
    Description = "Shows a notification when clicked",
    Callback = function() Fluent:Notify({Title="Button Clicked!", Content="The Main tab button works!", Duration=3}) end
})

-- --- Boost Tab ---
local BoostTab = Window:AddTab({ Title = "Boost", Icon = "zap" })
BoostTab:AddButton({
    Title = "Enable Jump Boost",
    Description = "Set Jump Power to 50",
    Callback = function()
        local player = LocalPlayer
        if player and player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
            local hum = player.Character:FindFirstChildOfClass("Humanoid")
            hum.UseJumpPower = true
            hum.JumpPower = 50
            Fluent:Notify({Title="Boost Enabled", Content="Jump Power set to 50!", Duration=3})
        else
            Fluent:Notify({Title="Boost Failed", Content="Character/humanoid not ready.", Duration=2})
        end
    end
})
BoostTab:AddButton({
    Title = "Disable Jump Boost",
    Description = "Reset Jump Power to default (16)",
    Callback = function()
        local player = LocalPlayer
        if player and player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
            local hum = player.Character:FindFirstChildOfClass("Humanoid")
            hum.JumpPower = 16
            Fluent:Notify({Title="Boost Disabled", Content="Jump Power reset to 16.", Duration=3})
        else
            Fluent:Notify({Title="Boost Failed", Content="Character/humanoid not ready.", Duration=2})
        end
    end
})

-- --- Visual Tab ---
local VisualTab = Window:AddTab({ Title = "Visual", Icon = "eye" })

-- Player ESP toggle (fixed: will remove highlights when turned off)
VisualTab:AddToggle({
    Title = "Player ESP",
    Description = "Highlights other players",
    Default = false,
    Callback = function(value)
        ESPEnabled = value
        if ESPEnabled then
            for _, p in ipairs(Players:GetPlayers()) do if p ~= LocalPlayer then AddESP(p) end end
        else
            -- disable: remove all highlights
            for p,_ in pairs(Highlights) do RemoveESP(p) end
        end
    end
})

-- ESP color picker
VisualTab:AddColorPicker({
    Title = "ESP Color",
    Default = ESPColor,
    Callback = function(color)
        ESPColor = color
        for p,h in pairs(Highlights) do
            if h and h.Parent then h.FillColor = ESPColor end
        end
    end
})

-- Skeleton button (keeps same behavior)
VisualTab:AddButton({
    Title = "Enable Skeleton",
    Description = "Draws red skeletons on players",
    Callback = function()
        SkeletonEnabled = true
        for _, plr in ipairs(Players:GetPlayers()) do
            if plr ~= LocalPlayer and plr.Character then
                if plr.Character:FindFirstChild("Skeleton") then plr.Character:FindFirstChild("Skeleton"):Destroy() end
                local skeleton = Instance.new("Model")
                skeleton.Name = "Skeleton"
                skeleton.Parent = plr.Character
                RunService.RenderStepped:Connect(function()
                    if not SkeletonEnabled then return end
                    -- cleanup old lines inside skeleton first
                    for _,c in pairs(skeleton:GetChildren()) do if c:IsA("Part") then c:Destroy() end end
                    local parts = {
                        "Head","UpperTorso","LowerTorso",
                        "LeftUpperArm","LeftLowerArm","LeftHand",
                        "RightUpperArm","RightLowerArm","RightHand",
                        "LeftUpperLeg","LeftLowerLeg","LeftFoot",
                        "RightUpperLeg","RightLowerLeg","RightFoot"
                    }
                    for i=1,#parts-1 do
                        local p1 = plr.Character and plr.Character:FindFirstChild(parts[i])
                        local p2 = plr.Character and plr.Character:FindFirstChild(parts[i+1])
                        if p1 and p2 then
                            local line = Instance.new("Part")
                            line.Anchored = true
                            line.CanCollide = false
                            line.Material = Enum.Material.Neon
                            line.Color = Color3.fromRGB(255,0,0)
                            line.Size = Vector3.new(0.12,0.12,(p1.Position - p2.Position).Magnitude)
                            line.CFrame = CFrame.new(p1.Position, p2.Position) * CFrame.new(0,0,-line.Size.Z/2)
                            line.Parent = skeleton
                        end
                    end
                end)
            end
        end
        Fluent:Notify({Title="Skeleton Enabled", Content="Red skeletons drawn on all players", Duration=3})
    end
})

-- Name & Distance toggle (shows name on first line, distance under it)
VisualTab:AddToggle({
    Title = "Names & Distance",
    Description = "Toggle name + distance display above players",
    Default = false,
    Callback = function(value)
        NameDistanceEnabled = value
        if NameDistanceEnabled then
            for _, p in ipairs(Players:GetPlayers()) do if p ~= LocalPlayer then CreateNameTag(p) end end
        else
            for p,_ in pairs(NameTags) do RemoveNameTag(p) end
        end
    end
})

-- FOV Radius slider (for aimbot)
VisualTab:AddSlider({
    Title = "Aimbot FOV Radius",
    Min = 20,
    Max = 500,
    Default = _G.CircleRadius,
    Callback = function(value)
        _G.CircleRadius = value
        if FOVCircle then FOVCircle.Radius = value end
    end
})

-- --- Combat Tab ---
local CombatTab = Window:AddTab({ Title = "Combat", Icon = "sword" })

-- Aimbot toggle with one-time notification
local AimbotNotificationShown = false
CombatTab:AddButton({
    Title = "Aimbot",
    Description = "Toggle Aimbot ON/OFF (hold RMB to aim)",
    Callback = function()
        _G.AimbotEnabled = not _G.AimbotEnabled
        if _G.AimbotEnabled then
            if not AimbotNotificationShown then
                Fluent:Notify({Title="Aimbot Enabled", Content="Hold Click To Aimbot", Duration=3})
                AimbotNotificationShown = true
            end
            _G.CircleVisible = true
            if FOVCircle then FOVCircle.Visible = true end
        else
            Fluent:Notify({Title="Aimbot Disabled", Content="Aimbot turned OFF", Duration=3})
            _G.CircleVisible = false
            if FOVCircle then FOVCircle.Visible = false end
        end
    end
})

-- Auto Click (placeholder)
local AutoClickEnabled = false
CombatTab:AddButton({
    Title = "Auto Click",
    Description = "Toggle Auto Click (placeholder)",
    Callback = function()
        AutoClickEnabled = not AutoClickEnabled
        Fluent:Notify({Title="Auto Click", Content = AutoClickEnabled and "Auto Click ON" or "Auto Click OFF", Duration=2})
    end
})

-- WalkSpeed
CombatTab:AddButton({
    Title = "Set WalkSpeed 50",
    Description = "Increases your walkspeed",
    Callback = function()
        if LocalPlayer and LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
            LocalPlayer.Character:FindFirstChildOfClass("Humanoid").WalkSpeed = 50
            Fluent:Notify({Title="WalkSpeed Changed", Content="WalkSpeed set to 50!", Duration=3})
        end
    end
})

-- ensure ESP/name tags applied to new players
Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Connect(function()
        if ESPEnabled then AddESP(plr) end
        if NameDistanceEnabled then CreateNameTag(plr) end
    end)
end)

-- done
